<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.15.1 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Computational Fluid Dynamics Python (CFD) - Python | Aditya Jaishankar</title>
<meta name="description" content="Class notes for the CFD-Python course taught by Prof. Lorena Barba, Boston University. The course outlines a 12 step program, each of increasing difficulty, towards building mastery solving the Navier-Stokes equations through finite difference techniques.">



<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Aditya Jaishankar">
<meta property="og:title" content="Computational Fluid Dynamics Python (CFD) - Python">
<meta property="og:url" content="http://localhost:4000/coursenotes/CFDpython/">


  <meta property="og:description" content="Class notes for the CFD-Python course taught by Prof. Lorena Barba, Boston University. The course outlines a 12 step program, each of increasing difficulty, towards building mastery solving the Navier-Stokes equations through finite difference techniques.">







  <meta property="article:published_time" content="2019-12-20T21:51:21-05:00">





  

  


<link rel="canonical" href="http://localhost:4000/coursenotes/CFDpython/">







  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "name": "Aditya Jaishankar",
      "url": "http://localhost:4000",
      "sameAs": null
    }
  </script>







<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Aditya Jaishankar Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE ]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->







<link href="https://fonts.googleapis.com/css?family=Crimson+Text" rel="stylesheet">





<!-- end custom head snippets -->

  </head>

  <body class="layout--single">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/"> </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/" >Home</a>
            </li><li class="masthead__menu-item">
              <a href="/coursework/" >ML/AI Coursework</a>
            </li><li class="masthead__menu-item">
              <a href="/projects/" >Projects</a>
            </li><li class="masthead__menu-item">
              <a href="/research/" >Ph.D. Research</a>
            </li><li class="masthead__menu-item">
              <a href="/publications/" >Publications</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      


  
    



<nav class="breadcrumbs">
  <ol itemscope itemtype="https://schema.org/BreadcrumbList">
    
    
    
      
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="http://localhost:4000/" itemprop="item"><span itemprop="name">Home</span></a>
          <meta itemprop="position" content="1" />
        </li>
        <span class="sep">/</span>
      
      
        
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="/coursenotes" itemprop="item"><span itemprop="name">Coursenotes</span></a>
          <meta itemprop="position" content="2" />
        </li>
        <span class="sep">/</span>
      
    
      
      
        <li class="current">Computational Fluid Dynamics Python (CFD) - Python</li>
      
    
  </ol>
</nav>

  


<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      

      
        <img src="/assets/images/profile.jpg" alt="Aditya Jaishankar" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Aditya Jaishankar</h3>
    
    
      <p class="author__bio" itemprop="description">
        <b>Ph.D., Massachusetts Institute of Technology.</b><br>Soft Condensed Matter Physicist and Surface Scientist.
      </p>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">New Jersey, USA</span>
        </li>
      

      
        
          
        
          
            <li><a href="https://www.github.com/aditya-jaishankar/" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
          
        
          
            <li><a href="https://www.linkedin.com/in/adityajaishankar" rel="nofollow noopener noreferrer"><i class="fab fa-linkedin" aria-hidden="true"></i> LinkedIn</a></li>
          
        
          
            <li><a href="/assets/misc/Resume_Jaishankar_191020.pdf" rel="nofollow noopener noreferrer"><i class="fas fa-file-alt" aria-hidden="true"></i> Resume</a></li>
          
        
      

      

      
        <li>
          <a href="mailto:aditya1642@gmail.com">
            <meta itemprop="email" content="aditya1642@gmail.com" />
            <i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i> Email
          </a>
        </li>
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Computational Fluid Dynamics Python (CFD) - Python">
    <meta itemprop="description" content="Class notes for the CFD-Python course taught by Prof. Lorena Barba, Boston University. The course outlines a 12 step program, each of increasing difficulty, towards building mastery solving the Navier-Stokes equations through finite difference techniques.">
    
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Computational Fluid Dynamics Python (CFD) - Python
</h1>
          
            <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  19 minute read
</p>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right ">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> On this page</h4></header>
              <ul class="toc__menu">
  <li><a href="#preliminaries">Preliminaries</a></li>
  <li><a href="#step-1-1-d-linear-convection">Step 1: 1-D Linear Convection</a></li>
  <li><a href="#step-2-nonlinear-1-d-convection">Step 2: Nonlinear 1-D convection</a></li>
  <li><a href="#step3-1-d-diffusion">Step3: 1-D Diffusion</a></li>
  <li><a href="#step-4-burgers-equation">Step 4: Burgers’ Equation</a></li>
  <li><a href="#step-5-2-d-linear-convection">Step 5: 2-D Linear Convection</a></li>
  <li><a href="#step-6-2-d-nonlinear-convection">Step 6: 2-D Nonlinear Convection</a></li>
  <li><a href="#step-7-2-d-diffusion">Step 7: 2-D Diffusion</a></li>
  <li><a href="#step-8-2-d-burgers-equation">Step 8: 2-D Burgers’ Equation</a></li>
  <li><a href="#some-remarks-on-analyzing-a-numerical-scheme">Some remarks on analyzing a numerical scheme</a>
    <ul>
      <li><a href="#defintions">Defintions</a></li>
      <li><a href="#numerical-diffusion">Numerical diffusion</a></li>
      <li><a href="#von-neumann-stability-analysis">von Neumann stability analysis</a></li>
    </ul>
  </li>
  <li><a href="#computation-of-the-navier-stokes-equations">Computation of the Navier-Stokes Equations</a></li>
  <li><a href="#step-9-laplace-equation">Step 9: Laplace Equation</a></li>
  <li><a href="#step-10-2d-poisson-equation">Step 10: 2D Poisson Equation</a></li>
  <li><a href="#step-11-cavity-flow-with-navier-stokes">Step 11: Cavity flow with Navier Stokes</a></li>
  <li><a href="#references">References</a></li>
</ul>
            </nav>
          </aside>
        
        <p>Class notes for the CFD-Python course taught by Prof. Lorena Barba, Boston University. The course outlines a 12 step program, each of increasing difficulty, towards building mastery solving the Navier-Stokes equations through finite difference techniques.<br />
<script type="math/tex">\begin{align}
\dfrac{\partial \vec{u}}{\partial t} +(\vec{u}\cdot\vec{\nabla})\vec{u} = -\dfrac{\vec{\nabla}P}{\rho}+\nu\vec{\nabla}^2\vec{u} + \sum\vec{F}_{\textrm{ext}} \label{eqn:NS}
\end{align}</script></p>

<h2 id="preliminaries">Preliminaries</h2>

<p>The Naiver-Stokes (N-S) equation represents the conservation of momentum of purely viscous, i.e. Newtonian fluids, written in differential form.<sup id="fnref:1"><a href="#fn:1" class="footnote">1</a></sup> For most realistic fluid transport problems, it is difficult to find analytical solutions to the N-S equation. In this class, we learn how to implement finite-difference based numerical solutions to the N-S equations using <code class="highlighter-rouge">python</code>, making heavy use of the <code class="highlighter-rouge">numpy</code> and <code class="highlighter-rouge">matplotlib</code> libraries.</p>

<p>The finite difference technique involves approximating the differential operator by making use Taylor series expansions. Given a differentiable function $f(x)$, we can use the Taylor series to approximate the function around the point $x = x_0$ as follows:</p>

<script type="math/tex; mode=display">\begin{align}
f(x_0 + \Delta x) = f(x_0) + \Delta x\left.\dfrac{\partial f(x)}{\partial x}\right|_{x = x_0} + O(\Delta x^2) \label{eqn:Taylor}
\end{align}</script>

<p>If $\Delta x$ is small enough, the higher order terms can be made negligibly small and hence we can rearrange terms in Equation \eqref{eqn:Taylor} to approximate the derivative as</p>

<script type="math/tex; mode=display">\begin{align}
\dfrac{\partial f(x)}{\partial x} = \dfrac{f(x + \Delta x) - f(x)}{\Delta x} + O(\Delta x) \label{eqn:TaylorDiff}
\end{align}</script>

<p>This is a fundamental result in the finite difference numerical scheme from which many other approximations to higher order derivatives can be derived.</p>

<h2 id="step-1-1-d-linear-convection">Step 1: 1-D Linear Convection</h2>

<p>We study how to implement the approximation shown in Equation \eqref{eqn:TaylorDiff} using the simplest example of 1-D linear convection, i.e., the 1-D wave equation, which is given by</p>

<script type="math/tex; mode=display">\begin{align}
\dfrac{\partial u}{\partial t} + c\dfrac{\partial u}{\partial x} = 0 \label{eqn:wave}
\end{align}</script>

<p>Here, $u(x, t)$ represents the velocity at position $x$ and time $t$, and $c$ is the wave propagation speed. We first discretize $t$ and $x$ into $t_0, t_1, \ldots, t_N$ and $x_0, x_1, \ldots, x_M$ points respectively. Let $t_{i+1} - t_{i} = \Delta t$ and $x_{j+1} - x_{j} = \Delta x$ for all $i \in {0, \ldots, N}$ and $i \in {0, \ldots, M}$. We use the notation $u_i^n$ to represent $u(x_i, t_n)$. Then, using Equation \eqref{eqn:TaylorDiff} we have</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{align}
\dfrac{\partial u}{\partial t} & \approx \dfrac{u_i^{n+1}-u_{i}^n}{\Delta t} \label{eqn:timeapprox} \\
\dfrac{\partial u}{\partial x} & \approx \dfrac{u_i^n-u_{i-1}^n}{\Delta x} \label{eqn:xapprox}
\end{align} %]]></script>

<p>and therefore the discretized wave equation becomes</p>

<script type="math/tex; mode=display">\begin{align}
\dfrac{u_i^{n+1}-u_{i}^n}{\Delta t} + c\dfrac{u_i^n-u_{i-1}^n}{\Delta x} = 0 \label{eqn:wave-equation-discrete}
\end{align}</script>

<p>Note that we use a <em>forward difference</em> approximation for time and a <em>backward difference</em> approximation for space. We have therefore converted the wave equation from a differential equation to a system of algebraic equations which can be solved with standard matrix methods. Given appropriate initial and boundary conditions,  the only unknown at each time point is $u^{n+1}_i$ and we can use a time-marching Euler scheme to solve for $u$ at every discrete point in time and space.</p>

<p>To see this, consider Equation \eqref{eqn:wave-equation-discrete} for the case $i=1$ and $n=0$ (the case $i=0$ and $n=0$ are known from initial and boundary conditions):</p>

<script type="math/tex; mode=display">\begin{align}
\dfrac{u_1^{1}-u_{1}^0}{\Delta t} + c\dfrac{u_1^0-u_{0}^0}{\Delta x} = 0 
\end{align}</script>

<p>which can rewritten as</p>

<script type="math/tex; mode=display">\begin{align}
u_1^1 = u_1^0 -c\dfrac{\Delta t}{\Delta x}(u_1^0-u_{0}^0) 
\end{align}</script>

<p>Because all the terms in the RHS are known, we can find $u_1^1$, and extending this scheme, we find $u_2^1, u_3^1, \ldots, u_M^1$. Having found the velocity all spatial grid points, we next march forward in time to $n=2$ and repeat the process, until $u$ is found for all time and space points in the grid.</p>

<p><strong>Exercise</strong></p>

<p>We implement the above scheme by solving Equation \eqref{eqn:wave-equation-discrete} using the initial conditions</p>

<script type="math/tex; mode=display">\begin{align}
u(x, 0) = 
\begin{cases}
2, 0.5 \leq x \leq 1, \\
1, \textrm{otherwise}
\end{cases} \label{eqn:ICs}
\end{align}</script>

<p>and the boundary condition $u(0, t) = u(2, t) = 1$.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>

<span class="c"># Initializing parameters</span>
<span class="n">nx</span> <span class="o">=</span> <span class="mi">41</span>  
<span class="n">dx</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">nx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">nt</span> <span class="o">=</span> <span class="mi">25</span>
<span class="n">dt</span> <span class="o">=</span> <span class="o">.</span><span class="mo">025</span>
<span class="n">c</span> <span class="o">=</span> <span class="mi">1</span>   

<span class="c"># Setting up the initial and boundary conditions</span>
<span class="n">u</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nx</span><span class="p">)</span>      <span class="c">#numpy function ones()</span>
<span class="n">u</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="o">.</span><span class="mi">5</span> <span class="o">/</span> <span class="n">dx</span><span class="p">):</span><span class="nb">int</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">dx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c">#setting u = 2 between 0.5 and </span>
                                     <span class="c"># 1 as per our I.C.s</span>

<span class="c"># Calculating solution</span>
<span class="n">un</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nt</span><span class="p">):</span>  <span class="c">#loop for values of n from 0 to nt</span>
    <span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">un</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">c</span> <span class="o">*</span> <span class="n">dt</span><span class="o">/</span> <span class="n">dx</span> <span class="o">*</span> <span class="p">(</span><span class="n">un</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">un</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</code></pre></div></div>

<p>Note that we have made use to <code class="highlighter-rouge">numpy</code>’s broadcasting property to calculate $u^n_i - u^n_{i-1}$. We now plot our solution:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">nx</span><span class="p">),</span> <span class="n">u</span><span class="p">);</span>
</code></pre></div></div>

<p><img src="/assets/images/coursenotes/CFDpython/step1.png" alt="test image size" width="75%" class="align-center" /></p>

<p>Here we see something strange! Our initial conditions suggest that we had a square pulse, and given the nature of the wave equation (with no diffusion or convection for now), we would expect this square to simply translate along x with time, but we see a rounded square here! This has happened because of numerical diffusion: our values of $\Delta x$ were too large. Indeed, we can make $\Delta x$ smaller and check that the initial square pulse translates as a square.</p>

<p>We made some arbitrary choices around the values of $\Delta x$ and $\Delta t$. Playing with the code, you will see that for some values of the $\Delta x$ and $\Delta t$, the solution seems unstable and in reality, we need to be careful about the how we go about choosing $\Delta x$ and $\Delta t$. We require that the distance traveled $u\Delta t$ travelled by the wave in the time interval $\Delta t$ be less than the chosen value of $\Delta x$. There is detailed theory behind this, capture by the Courant-Friendrichs-Lewy (CLF) condition.<sup id="fnref:2"><a href="#fn:2" class="footnote">2</a></sup> Formally, we require</p>

<script type="math/tex; mode=display">\begin{align}
\dfrac{u\Delta t}{\Delta x} \leq \sigma_\textrm{max}
\end{align}</script>

<p>where $\sigma_\textrm{max} \leq 1$ is the Courant number whose value changes with the exact numerical method being used. For the explicit Euler scheme described above, $\sigma_\textrm{max} \approx 1$. We will see more about this later while looking at solving equations in higher dimensions.</p>

<h2 id="step-2-nonlinear-1-d-convection">Step 2: Nonlinear 1-D convection</h2>

<p>The equation for nonlinear 1-D convection is</p>

<script type="math/tex; mode=display">\begin{align}
\dfrac{\partial u}{\partial t} + u\dfrac{\partial u}{\partial x} = 0
\end{align}</script>

<p>Using the ideas above, it is simple to discretize this equation, and solving for the unknown term $u_i^{n+1}$, we have</p>

<script type="math/tex; mode=display">\begin{align}
u_i^{n+1} = u_i^{n}  -\dfrac{\Delta t}{\Delta x} u_i^{n}(u_i^{n} - u_{i-1}^{n})
\end{align}</script>

<p>We use the same initial conditions as in Equation \eqref{eqn:ICs}. This is fairly easy to implement and very similar to the simple 1-D linear convection case above, with the replace $c \rightarrow u$. We therefore omit the exercise here.</p>

<h2 id="step3-1-d-diffusion">Step3: 1-D Diffusion</h2>

<p>For constant diffusivity $\nu$, the 1-D diffusion equation is</p>

<script type="math/tex; mode=display">\begin{align}
\dfrac{\partial u}{\partial t} = \nu\dfrac{\partial^2 u}{\partial t^2} \label{eqn:diffusion1d}
\end{align}</script>

<p>We now need to discretize the second order derivative. Again, we start with the Taylor series expansion for $u = u_{i+1}$ and $u = u_{i-1}$ around $u = u_i$:</p>

<script type="math/tex; mode=display">\begin{align}
u_{i+1} = u_i + \Delta x \left.\dfrac{\partial u}{\partial x}\right|_{i} + 
            \dfrac{\Delta x^2}{2!} \left.\dfrac{\partial^2 u}{\partial x^2}\right|_{i} + 
            \dfrac{\Delta x^3}{3!} \left.\dfrac{\partial^3 u}{\partial x^3}\right|_{i} + 
            O(\Delta x^4) \\
u_{i-1} = u_i - \Delta x \left.\dfrac{\partial u}{\partial x}\right|_{i} + 
            \dfrac{\Delta x^2}{2!} \left.\dfrac{\partial^2 u}{\partial x^2}\right|_{i} -
            \dfrac{\Delta x^3}{3!} \left.\dfrac{\partial^3 u}{\partial x^3}\right|_{i} + 
            O(\Delta x^4) 
\end{align}</script>

<p>Adding these two equations, we find that</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{align}
u_{i+1} + u_{i-1} & = 2\left( u_i + \dfrac{\Delta x^2}{2!} \left.\dfrac{\partial^2 u}{\partial x^2}\right|_{i} \right) + 
                    O(\Delta x^4) \\
\Rightarrow \left.\dfrac{\partial^2 u}{\partial x^2}\right|_{i} & = 
            \dfrac{u_{i+1} -2u_i + u_{i-1}}{\Delta x^2} + O(\Delta x^2) \label{eqn:second-order-discrete}
\end{align} %]]></script>

<p>The terms on the LHS tells us that we have performed a <em>central difference</em> (CD), as opposed to the forward and backward difference, FD anf BD, we have seen so far. The CD ignores terms of $O(\Delta x^2)$, while FD and BD ignore terms of order $O(\Delta x)$ and hence has higher accuracy. Discretizing the equations by using Equations \eqref{eqn:timeapprox} and \eqref{eqn:second-order-discrete}  in \eqref{eqn:diffusion1d} and rearranging terms, we have</p>

<script type="math/tex; mode=display">\begin{align}
u_i^{n+1} = u_i^n + \dfrac{\nu \Delta t}{\Delta x^2}(u_{i+1}^n - 2 u_i^n + u_{i-1}^n) \label{eqn:1ddiffusion-discrete}
\end{align}</script>

<p>along with the same initial conditions as in Equation \eqref{eqn:ICs}. Because this equation is in 2_d, the CLF condition is modified, and now becomes:</p>

<script type="math/tex; mode=display">\begin{align}
\dfrac{\nu \Delta t}{\Delta x} \leq \sigma
\end{align}</script>

<p>The physical intuition remains the same: $\nu \Delta t$ is the the root-mean-square distance traveled by a fluid element in time $\Delta t$ because of diffusion and this has to be a constant fraction $\sigma &lt; 1$ of $\Delta x^2$. Below we implement Equation \eqref{eqn:1ddiffusion-discrete} in Python, while omitting the code for initializing variables and setting initial conditions, which has already been shown in Step 1)</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nt</span><span class="p">):</span>
    <span class="n">un</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">un</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">nu</span>  <span class="o">*</span> <span class="n">dt</span> <span class="o">/</span> <span class="n">dx</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">un</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">un</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">un</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">un</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">nu</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">/</span> <span class="n">dx</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">un</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">un</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> 
                <span class="n">un</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
</code></pre></div></div>
<p><img src="/assets/images/coursenotes/CFDpython/step3-lowdiff.png" alt="test image size" width="49%" /> <img src="/assets/images/coursenotes/CFDpython/step3-highdiff.png" alt="test image size" width="49%" /></p>

<p>The image on the left was generated with <code class="highlighter-rouge">nt = 20</code> and the one on the righ with <code class="highlighter-rouge">nt = 400</code>. We see how diffusion tends to ‘smear out’ the initial square velocity waveform.</p>

<h2 id="step-4-burgers-equation">Step 4: Burgers’ Equation</h2>

<p>The Burgers’ equation combines 1-D nonlinear convection with 1-D diffusion, i.e., puts together step 2 and step 3 from above. The equation is</p>

<script type="math/tex; mode=display">\begin{align}
\frac{\partial u}{\partial t} + u \frac{\partial u}{\partial x} = \nu \frac{\partial ^2u}{\partial x^2}
\end{align}</script>

<p>We can discrete the first order and second order terms as described above and then rearrange terms to solve for the only unknown $u_i^{n+1}$. Putting together everything and carrying out the algebra, we arrive at</p>

<script type="math/tex; mode=display">\begin{align}
u_i^{n+1} = u_i^n - u_i^n \frac{\Delta t}{\Delta x} (u_i^n - u_{i-1}^n) + \nu \frac{\Delta t}{\Delta x^2}(u_{i+1}^n - 2u_i^n + u_{i-1}^n)
\end{align}</script>

<p>along with the initial and boundary conditions given in Equation \eqref{eqn:ICs}. Because this is a straightforward implementation of steps 2 and 3 in a single equation, we omit any detailed analysis and move on to step 5.</p>

<h2 id="step-5-2-d-linear-convection">Step 5: 2-D Linear Convection</h2>

<p>We modify Equation \eqref{eqn:wave} to now include a derivative in the $y$ direction:</p>

<script type="math/tex; mode=display">\begin{equation}
\dfrac{\partial u}{\partial t}+c\left(\dfrac{\partial u}{\partial x} + \dfrac{\partial u}{\partial y}\right) = 0 \label{eqn:wave2d}
\end{equation}</script>

<p>By now, discretizing equations has become routine! Equation \eqref{eqn:wave2d}, discretized and rearranged, becomes</p>

<script type="math/tex; mode=display">\begin{equation}
u_{i,j}^{n+1} = u_{i,j}^n-c \frac{\Delta t}{\Delta x}(u_{i,j}^n-u_{i-1,j}^n)-c \frac{\Delta t}{\Delta y}(u_{i,j}^n-u_{i,j-1}^n)
\end{equation}</script>

<p>So far, because we lived in 1-D space we modeled $u_i$ as a being a vector of length $M+1$. While expanding to 2 dimensions, we now model $u_{i,j}$ as being a 2-D array, indexed by indices $i,j$.  The initial and boundary conditions are</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{align}
u(x,y) & = \begin{cases}
\begin{matrix}
2,  & 0.5 \leq x, y \leq 1 \cr
1, & \text{otherwise}
\end{matrix}
\end{cases} \label {eqn:IC2d}\\

u(x,y) & = 1\ \text{for } \begin{cases}
\begin{matrix}
x =  0,\ 2 \cr
y =  0,\ 2 \end{matrix}\end{cases} \label{eqn:BC2d}
\end{align} %]]></script>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">Axes3D</span>  <span class="c"># Required for 3d plots</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">cm</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>

<span class="c"># variable initialization</span>
<span class="n">nx</span> <span class="o">=</span> <span class="n">ny</span> <span class="o">=</span> <span class="mi">201</span>
<span class="n">dx</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">nx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">dy</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">ny</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">c</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="o">.</span><span class="mi">5</span> <span class="c"># from the CLF condition</span>
<span class="n">dt</span> <span class="o">=</span> <span class="n">sigma</span> <span class="o">*</span> <span class="p">(</span><span class="n">dx</span> <span class="o">/</span> <span class="n">c</span><span class="p">)</span>
<span class="n">nt</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="o">.</span><span class="mi">7</span><span class="o">/</span><span class="n">dt</span><span class="p">)</span>
<span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">))</span>

<span class="c"># Initial conditions</span>
<span class="n">u</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="mf">0.5</span><span class="o">/</span><span class="n">dx</span><span class="p">):</span><span class="nb">int</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">dx</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.5</span><span class="o">/</span><span class="n">dy</span><span class="p">):</span><span class="nb">int</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">dy</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>

<span class="c"># Plot Initial Conditions</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">nx</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">nx</span><span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s">'3d'</span><span class="p">)</span>
<span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">sparse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s">'viridis'</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="/assets/images/coursenotes/CFDpython/step5-initial.png" alt="test image size" width="75%" class="align-center" /></p>

<p>The inital waveform is a rectangular box. We now implement the numerical scheme and see how this initial waveform is convected and diffused over time in two dimensions.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nt</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">un</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="p">(</span><span class="n">un</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="p">(</span><span class="n">c</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="n">dx</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">un</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">un</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:])</span> <span class="o">-</span>
                <span class="p">(</span><span class="n">c</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="n">dy</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">un</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">un</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
<span class="c"># Do the 3D plotting of the results</span>
<span class="n">fig_result</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig_result</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s">'3d'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s">'viridis'</span><span class="p">)</span>
</code></pre></div></div>
<p><img src="/assets/images/coursenotes/CFDpython/step5-final.png" alt="test image size" width="75%" class="align-center" /></p>

<p>As expected the waveform has been translated (convected) as well as smeared-out (diffused) in two dimensions.</p>

<h2 id="step-6-2-d-nonlinear-convection">Step 6: 2-D Nonlinear Convection</h2>

<p>We now extend our analysis to 2-D nonlinear convection, where have velocity components $u$ in the $x$ direction and $v$ in the $y$ direction. The transport equations are</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{align}
\frac{\partial u}{\partial t} + u \frac{\partial u}{\partial x} + v \frac{\partial u}{\partial y} & = 0 \\
\frac{\partial v}{\partial t} + u \frac{\partial v}{\partial x} + v \frac{\partial v}{\partial y} & = 0
\end{align} %]]></script>

<p>Note that we have two equation because the original NS equation is a vector equation, with one equation for each component of velocity. Discretizing these equations, and solving for the two unknowns $u_i^{n+1}$ and $v_n^{n+1}$, we obtain</p>

<script type="math/tex; mode=display">\begin{align}
u_{i,j}^{n+1} = u_{i,j}^n - u_{i,j} \frac{\Delta t}{\Delta x} (u_{i,j}^n-u_{i-1,j}^n) - v_{i,j}^n \frac{\Delta t}{\Delta y} (u_{i,j}^n-u_{i,j-1}^n) \\

v_{i,j}^{n+1} = v_{i,j}^n - u_{i,j} \frac{\Delta t}{\Delta x} (v_{i,j}^n-v_{i-1,j}^n) - v_{i,j}^n \frac{\Delta t}{\Delta y} (v_{i,j}^n-v_{i,j-1}^n)
\end{align}</script>

<p>The intial conditions are the same as \label{eqn:IC2d} but the boundary condition is modified to</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{align}
u,\ v\ = \begin{cases}\begin{matrix}
2 & \text{for } x,y \in (0.5, 1)\times(0.5,1) \cr
1 & \text{everywhere else}
\end{matrix}\end{cases} \label{Eqn:BC2dnew}
\end{align} %]]></script>

<p>The solution is implemented as follows:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Initializations</span>
<span class="n">nx</span> <span class="o">=</span> <span class="mi">101</span>
<span class="n">ny</span> <span class="o">=</span> <span class="mi">101</span>
<span class="n">dx</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">nx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">dy</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">ny</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="n">sigma</span> <span class="o">=</span> <span class="o">.</span><span class="mi">2</span>
<span class="n">c</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">dt</span> <span class="o">=</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">dx</span> <span class="o">/</span> <span class="n">c</span>
<span class="n">nt</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="o">.</span><span class="mi">5</span><span class="o">/</span><span class="n">dt</span><span class="p">)</span>

<span class="c"># Initial conditions</span>
<span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">nx</span><span class="p">,</span><span class="n">ny</span><span class="p">))</span>
<span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">))</span>

<span class="n">u</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="o">.</span><span class="mi">5</span><span class="o">/</span><span class="n">dx</span><span class="p">):</span><span class="nb">int</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">dx</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="o">.</span><span class="mi">5</span><span class="o">/</span><span class="n">dy</span><span class="p">):</span><span class="nb">int</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">dy</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">v</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="o">.</span><span class="mi">5</span><span class="o">/</span><span class="n">dy</span><span class="p">):</span><span class="nb">int</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">dy</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="o">.</span><span class="mi">5</span><span class="o">/</span><span class="n">dy</span><span class="p">):</span><span class="nb">int</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">dy</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
</code></pre></div></div>

<p>A plot of the intial conditions looks the same as in Step 5. We proceed to solving the equations and plotting the results</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Solution</span>
<span class="n">un</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">vn</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nt</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
    <span class="n">un</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">vn</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">un</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="p">(</span><span class="n">un</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">1</span><span class="p">:]</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="n">dx</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">un</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">un</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:])</span> <span class="o">-</span> <span class="p">(</span><span class="n">vn</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">1</span><span class="p">:]</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="n">dy</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">un</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">un</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">vn</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="p">(</span><span class="n">un</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">1</span><span class="p">:]</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="n">dx</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">vn</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">vn</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:])</span> <span class="o">-</span> <span class="p">(</span><span class="n">vn</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">1</span><span class="p">:]</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="n">dy</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">vn</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">vn</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">nx</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">ny</span><span class="p">)</span>

<span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<span class="c"># Plot of u</span>
<span class="n">fig_result_u</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>
<span class="n">ax_u</span> <span class="o">=</span> <span class="n">fig_result_u</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s">'3d'</span><span class="p">)</span>
<span class="n">ax_u</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s">'viridis'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">v_plot</span><span class="p">)</span>

<span class="c"># Plot of v</span>
<span class="n">fig_result_v</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>
<span class="n">ax_v</span> <span class="o">=</span> <span class="n">fig_result_v</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s">'3d'</span><span class="p">)</span>
<span class="n">v_plot</span> <span class="o">=</span> <span class="n">ax_v</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s">'viridis'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">v_plot</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="/assets/images/coursenotes/CFDpython/step6-usoln.png" alt="test image size" width="49%" /> <img src="/assets/images/coursenotes/CFDpython/step6-vsoln.png" alt="test image size" width="49%" /></p>

<h2 id="step-7-2-d-diffusion">Step 7: 2-D Diffusion</h2>

<p>The 2-D diffusion equation is:</p>

<script type="math/tex; mode=display">\begin{align}
\frac{\partial u}{\partial t} = \nu \frac{\partial ^2 u}{\partial x^2} + \nu \frac{\partial ^2 u}{\partial y^2}
\end{align}</script>

<p>which can be descritized and rearranged to find $u_i^{n+1}:</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{align}
u_{i,j}^{n+1} = & u_{i,j}^n + \frac{\nu \Delta t}{\Delta x^2}(u_{i+1,j}^n - 2 u_{i,j}^n + u_{i-1,j}^n) +  \\
& \frac{\nu \Delta t}{\Delta y^2}(u_{i,j+1}^n-2 u_{i,j}^n + u_{i,j-1}^n)
\end{align} %]]></script>

<p>We define a function <code class="highlighter-rouge">diffusion_plotter(nt)</code> which takes in the number of timesteps to calculate so that we can see how diffusion smears out the intial pulse in two dimensions (intializations and setting up of intial conditons can be implemented as above)</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">diffusion_plotter</span><span class="p">(</span><span class="n">nt</span><span class="p">):</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">))</span>
    <span class="n">u</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="o">.</span><span class="mi">5</span> <span class="o">/</span> <span class="n">dy</span><span class="p">):</span><span class="nb">int</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">dy</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="o">.</span><span class="mi">5</span> <span class="o">/</span> <span class="n">dx</span><span class="p">):</span><span class="nb">int</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">dx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">2</span>  
    
    <span class="n">un</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nt</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">un</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">nu</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="n">dx</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">un</span><span class="p">[</span><span class="mi">2</span><span class="p">:,</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">un</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">un</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> 
                         <span class="n">nu</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="n">dy</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">un</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">:]</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">un</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">un</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">]))</span>
        
        <span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">u</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">u</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">u</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        
        <span class="n">un</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        
    <span class="n">fig_result</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>
    <span class="n">ax_result</span> <span class="o">=</span> <span class="n">fig_result</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
    <span class="n">result_plot</span> <span class="o">=</span> <span class="n">ax_result</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">result_plot</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="/assets/images/coursenotes/CFDpython/step7-timestep5.png" alt="test image size" width="49%" /> <img src="/assets/images/coursenotes/CFDpython/step7-timestep15.png" alt="test image size" width="49%" />
<img src="/assets/images/coursenotes/CFDpython/step7-timestep50.png" alt="test image size" width="49%" /> <img src="/assets/images/coursenotes/CFDpython/step7-timestep100.png" alt="test image size" width="49%" /></p>

<h2 id="step-8-2-d-burgers-equation">Step 8: 2-D Burgers’ Equation</h2>

<p>The 2-D Burgers’ equation puts together 2-D nonlinear convection (Step 6) and 2-D diffusion (Step 7). The equations for $u$ and $v$ are</p>

<script type="math/tex; mode=display">\begin{align}
\frac{\partial u}{\partial t} + u \frac{\partial u}{\partial x} + v \frac{\partial u}{\partial y} = \nu \; \left(\frac{\partial ^2 u}{\partial x^2} + \frac{\partial ^2 u}{\partial y^2}\right) \\

\frac{\partial v}{\partial t} + u \frac{\partial v}{\partial x} + v \frac{\partial v}{\partial y} = \nu \; \left(\frac{\partial ^2 v}{\partial x^2} + \frac{\partial ^2 v}{\partial y^2}\right)
\end{align}</script>

<p>There can be discretized and rearranged (after some algebra!) to obtain</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{align}
\nonumber u_{i,j}^{n+1} = & u_{i,j}^n - \frac{\Delta t}{\Delta x} u_{i,j}^n (u_{i,j}^n - u_{i-1,j}^n)  - \frac{\Delta t}{\Delta y} v_{i,j}^n (u_{i,j}^n - u_{i,j-1}^n) + \\
& \frac{\nu \Delta t}{\Delta x^2}(u_{i+1,j}^n-2u_{i,j}^n+u_{i-1,j}^n) + \frac{\nu \Delta t}{\Delta y^2} (u_{i,j+1}^n - 2u_{i,j}^n + u_{i,j-1}^n)
\end{align} %]]></script>

<script type="math/tex; mode=display">% <![CDATA[
\begin{align}
\nonumber v_{i,j}^{n+1} = & v_{i,j}^n - \frac{\Delta t}{\Delta x} u_{i,j}^n (v_{i,j}^n - v_{i-1,j}^n) - \frac{\Delta t}{\Delta y} v_{i,j}^n (v_{i,j}^n - v_{i,j-1}^n) \\
&+ \frac{\nu \Delta t}{\Delta x^2}(v_{i+1,j}^n-2v_{i,j}^n+v_{i-1,j}^n) + \frac{\nu \Delta t}{\Delta y^2} (v_{i,j+1}^n - 2v_{i,j}^n + v_{i,j-1}^n)
\end{align} %]]></script>

<p>We implement the solution below:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Initialization</span>
<span class="n">nx</span> <span class="o">=</span> <span class="mi">41</span>
<span class="n">ny</span> <span class="o">=</span> <span class="mi">41</span>
<span class="n">nt</span> <span class="o">=</span> <span class="mi">2000</span>
<span class="n">c</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">dx</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">nx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">dy</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">ny</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="o">.</span><span class="mo">000</span><span class="mi">9</span>
<span class="n">nu</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="n">dt</span> <span class="o">=</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">dx</span> <span class="o">*</span> <span class="n">dy</span> <span class="o">/</span> <span class="n">nu</span>


<span class="n">x</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">nx</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">ny</span><span class="p">)</span>

<span class="n">u</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">ny</span><span class="p">,</span> <span class="n">nx</span><span class="p">))</span>
<span class="n">v</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">ny</span><span class="p">,</span> <span class="n">nx</span><span class="p">))</span>
<span class="n">un</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">ny</span><span class="p">,</span> <span class="n">nx</span><span class="p">))</span> 
<span class="n">vn</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">ny</span><span class="p">,</span> <span class="n">nx</span><span class="p">))</span>
<span class="n">comb</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">ny</span><span class="p">,</span> <span class="n">nx</span><span class="p">))</span>

<span class="c"># Initial conditions</span>
<span class="n">u</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="o">.</span><span class="mi">5</span> <span class="o">/</span> <span class="n">dy</span><span class="p">):</span><span class="nb">int</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">dy</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="o">.</span><span class="mi">5</span> <span class="o">/</span> <span class="n">dx</span><span class="p">):</span><span class="nb">int</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">dx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">2</span> 
<span class="n">v</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="o">.</span><span class="mi">5</span> <span class="o">/</span> <span class="n">dy</span><span class="p">):</span><span class="nb">int</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">dy</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="o">.</span><span class="mi">5</span> <span class="o">/</span> <span class="n">dx</span><span class="p">):</span><span class="nb">int</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">dx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">2</span>

<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nt</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span> <span class="c">##loop across number of time steps</span>
    <span class="n">un</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">vn</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">un</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span>
                     <span class="n">dt</span> <span class="o">/</span> <span class="n">dx</span> <span class="o">*</span> <span class="n">un</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> 
                     <span class="p">(</span><span class="n">un</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">un</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span> <span class="o">-</span> 
                     <span class="n">dt</span> <span class="o">/</span> <span class="n">dy</span> <span class="o">*</span> <span class="n">vn</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> 
                     <span class="p">(</span><span class="n">un</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">un</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> 
                     <span class="n">nu</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">/</span> <span class="n">dx</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> 
                     <span class="p">(</span><span class="n">un</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">:]</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">un</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">un</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span> <span class="o">+</span> 
                     <span class="n">nu</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">/</span> <span class="n">dy</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> 
                     <span class="p">(</span><span class="n">un</span><span class="p">[</span><span class="mi">2</span><span class="p">:,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">un</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">un</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
    
    <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">vn</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> 
                     <span class="n">dt</span> <span class="o">/</span> <span class="n">dx</span> <span class="o">*</span> <span class="n">un</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span>
                     <span class="p">(</span><span class="n">vn</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">vn</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span> <span class="o">-</span>
                     <span class="n">dt</span> <span class="o">/</span> <span class="n">dy</span> <span class="o">*</span> <span class="n">vn</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> 
                    <span class="p">(</span><span class="n">vn</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">vn</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> 
                     <span class="n">nu</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">/</span> <span class="n">dx</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> 
                     <span class="p">(</span><span class="n">vn</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">:]</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">vn</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">vn</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span> <span class="o">+</span>
                     <span class="n">nu</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">/</span> <span class="n">dy</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span>
                     <span class="p">(</span><span class="n">vn</span><span class="p">[</span><span class="mi">2</span><span class="p">:,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">vn</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">vn</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
     
    <span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">u</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">u</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">u</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    
    <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">v</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">v</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">v</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c"># Plot the solution</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s">'3d'</span><span class="p">)</span>
<span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">viridis</span><span class="p">,</span> <span class="n">rstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cstride</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">viridis</span><span class="p">,</span> <span class="n">rstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cstride</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">'$x$'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">'$y$'</span><span class="p">);</span>
</code></pre></div></div>

<p><img src="/assets/images/coursenotes/CFDpython/step8-soln.png" alt="test image size" width="100%" class="align-center" /></p>

<p>The intial pulse has been translated, sheared, and smeared, as expected by the different elements of the Burgers’ equation.</p>

<h2 id="some-remarks-on-analyzing-a-numerical-scheme">Some remarks on analyzing a numerical scheme</h2>

<p>There are primarily three properties that are used in the analysis of a numerical scheme: consistency, stability, and convergence. These are defined as below:</p>

<h3 id="defintions">Defintions</h3>

<p><strong>Consistency</strong></p>

<p>The numerical scheme must tend to the analytical differential equation as the the time and space steps tend to 0.</p>

<p><strong>Stability</strong></p>

<p>A conditon on the scheme (and not on the differential equation) that all errors must remain bounded as the scheme progresses for finite $\Delta x$, $\Delta t$, as the number of time steps $n \to \infty$. If the error of the discretized equation is given by $\bar{\epsilon}^n_i = u_i^n - \bar{u}_i^n$, where $u_i^n$ is the computed solution and $\bar{u}_i^n$ is the exact solution of the numerical scheme, then the scheme is stable if</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{align}
\lim_{n \to \infty} \lvert \bar{\epsilon} \rvert < K
\end{align} %]]></script>

<p>for all fixed $\Delta t$ and $\Delta x$.</p>

<p><strong>Convergence</strong></p>

<p>This is a condition on the numerical solution that states that the scheme is convergent if the discretized solution tends to the exact solution as $\Delta x$ and $\Delta t$ both tend to zero. That is, if $\tilde{\epsilon}_i^n = \tilde{u}_i^n - \tilde{u}_i^n$ is the error between the computed solution to the numerical scheme $u_i^n$ and the exact analytical solution $\tilde{u}_i^n$, then the scheme is convergent if</p>

<script type="math/tex; mode=display">\begin{align}
\lim_{\Delta x_i \to 0} \lvert \tilde{\epsilon} \rvert = 0
\end{align}</script>

<p>In summary, consistency connects the discretized equation to the analytical differential equation, stability connects the numerical solution to the exact solution of the scheme, and convergence ensures that the numerical solution approaches the exact solution of the analytical differential equation.</p>

<p><strong>The equivalence theorem of Lax</strong></p>

<p>For a well-posed IVP and a consistent discretization scheme, stability is the necessary and sufficient condition for convergence.</p>

<h3 id="numerical-diffusion">Numerical diffusion</h3>

<p>Consider the discretized form of the wave equation shown in Equation \eqref{eqn:wave-equation-discrete}. It can be shown by writing out Taylor series expansions and some rearrangement that</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{align}
& \dfrac{u_i^{n+1} -u_i^n}{\Delta t} + \dfrac{c}{2\Delta x}(u_{i+1}^n -u_{i-1}^n) - \left(\dfrac{\partial u}{\partial t} +c \dfrac{\partial u}{\partial x}\right)_i^n = \\
& \dfrac{\Delta t}{2}\left.\dfrac{\partial^2 u}{\partial t^2}\right|_i^n + \dfrac{c\Delta x^2}{6}\left.\dfrac{\partial^3 u}{\partial t^3}\right|_i^n + O(\Delta t^2, \Delta x^4) \label{eqn:trunc}
\end{align} %]]></script>

<p>The term in the RHS is known as the truncation error $\epsilon_T$. Now consider an exact solution to the discretized equation $\bar{u}_i^n$. Then by defintion,</p>

<script type="math/tex; mode=display">\begin{align}
\dfrac{\bar{u} _i^{n+1} - \bar{u} _i^n}{\Delta t} + \dfrac{c}{2\Delta x}(\bar{u} _{i+1}^n - \bar{u} _{i-1}^n) = 0
\end{align}</script>

<p>Using this result in the Equation \ref{eqn:trunc}, we have that</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{align}
& \left(\dfrac{\partial \bar{u}}{\partial t} +c \dfrac{\partial \bar{u}}{\partial x}\right)_i^n = \\
& \dfrac{\Delta t}{2}\left.\dfrac{\partial^2 u}{\partial t^2}\right|_i^n + \dfrac{c\Delta x^2}{6}\left.\dfrac{\partial^3 u}{\partial t^3}\right|_i^n + O(\Delta t^2, \Delta x^4) \label{eqn:int}
\end{align} %]]></script>

<p>Simplifying notation and rearranging, we get</p>

<script type="math/tex; mode=display">\begin{align}
\left(\bar{u} _t\right)_i^n = -c\left(\bar{u} _x\right)_i^n + O(\Delta t, \Delta x^2) 
\end{align}</script>

<p>Differentiating the above equation with repect to time, and noting that the order of differentiation can be switched because of the well-behaved nature of $u$, we finally obtain</p>

<script type="math/tex; mode=display">\begin{align}
\left(\bar{u} _tt\right)_i^n = c^2\left(\bar{u} _x\right)_i^n + O(\Delta t, \Delta x^2) 
\end{align}</script>

<p>Plugging this result back into Equation \ref{eqn:int} we obtain the <em>modified differential equation</em></p>

<script type="math/tex; mode=display">\begin{align}
\bar{u} _t + c\bar{u} _x = -\dfrac{\Delta t}{2} c^2 \bar{u} _{xx} + O(\Delta t^2, \Delta x^2)
\end{align}</script>

<p>The exact solution to the numerical scheme satisfies this equation. Note that we started with wave equation which only talks about pure convection, but using a numerical scheme introduced a diffusion term. This phenomenon is termed numerical diffusion. In this particular case, note that the diffusion coefficient is negative! So this diffusion term is unstable. By physical analogy, a negative diffusion coeffient corresponds to a negative viscosity, and small perturbations are amplified instead of dispersed, making the solution blow up. We will see more about looking at stable and unstable scheme while studying von Neumann stability analysis.</p>

<p>Below are the steps to determine the modified differential equation:</p>

<ol>
  <li>
    <p>Perform the consistency analysis and find the truncation error: $N(u_i^n) - D(u) = \epsilon_T$, where $D(u)$ is the mathematical model we wish to solve numerically and $N(u_i^n)$ is the numerical scheme we implement.</p>
  </li>
  <li>
    <p>Consider the exact solution of the numerical scheme $\bar{u} _i^n$ defined by $N(\bar{u} _i^n) = 0$, to obtain the differential equation $D(\bar{u} _i^n) = -\bar{\epsilon} _T$.</p>
  </li>
  <li>
    <p>Replace the lowest time derivative with a space derivative in $\bar{\epsilon} _T$ by taking suitable derivatives.</p>
  </li>
  <li>
    <p>The modified differential equation is defined as an equation obtained after the replacement in the step above, restricted to the lowest order terms (containing space derivatives only).</p>
  </li>
</ol>

<h3 id="von-neumann-stability-analysis">von Neumann stability analysis</h3>

<p>The central idea in the von Neumann stability analysis is to expand the solution (or error) in a finite Fourier series. Consider a 1D domain $(0,L)$ and reflect it into $(-L,0)$, and generate meshpoints each of length $\Delta x$. The smallest resolvable wavelength is $\lambda_\textrm{min} = 2\Delta x$ and the largest resolvable wavelength is $2L$. This implies $k_\textrm{min} = 2\pi/\lambda_{min} = \pi/L$ and hence $k_j = j k_\textrm{min} = j\pi/L = j\pi/(N\Delta x)$. Moreover, the phase angle $\phi_j = j\pi/N$. This covers the whole domain $[-\pi, \pi]$ in steps of $\pi/N$. The key step in the analysis is to decompose the solution as</p>

<script type="math/tex; mode=display">\begin{align}
u_i^n = \sum\limits_{-N}^N V_j^n e^{I k_j x_i} = \sum\limits_{-N}^N V_j^n e^{I i j \pi/N} 
\end{align}</script>

<p>where $V_j^n$ is the amplitude of the $j$-th harmonic.</p>

<p>The stability criterion states that the amplitude of no harmonic grows indefinitely as $n \to \infty$. We define the amplification factor $G=\frac{V^{n+1}}{V^n}$. The stability criterion requires that $\lvert G \rvert \leq 1$ for all $\phi_j = j\pi/N, j \in [-N, N]$. We show a simple example below.</p>

<p>Consider again the wave equation that uses a forward difference in time and a central difference in space:</p>

<script type="math/tex; mode=display">\begin{align}
\dfrac{u_i^{n+1}} - u_i^n}{\Delta t} + \dfrac{c}{2\Dekta x}(u_{i+1}^n - u_{i-1}^n) = 0
\end{align}</script>

<p>Setting $\sigma = c\Delta t/\Delta x$ and writing in explicit form,</p>

<script type="math/tex; mode=display">\begin{align}
u_i^{n+1} = u)i^n -\dfrac{\sigma}{2}\left(u_{i+1} ^n - u_{i-1} ^n\right) \label{eqn:wave-discrete-neumann}
\end{align}</script>

<p>Now we replace all terms of the form $u_{i+m} ^{n+k}$ by its Fourier expansion</p>

<script type="math/tex; mode=display">\begin{align}
V^{n+k} e^{I(i+m)\phi}
\end{align}</script>

<p>Note we can essentially ignore the subscript $j$ because from orthonormality of Fourier modes, if the sum of the different modes is zero, then the Fourier coefficient of each individual mode should be zero. Substiuting the Fourier expansion into Equation~\ref{eqn:wave-discrete-neumann}, we have</p>

<script type="math/tex; mode=display">\begin{align}
V^{n+1} e^{I(i)\phi} = V^{n} e^{I(i)\phi} - \dfrac{\sigma}{2}\left(V^{n} e^{I(i+1)\phi} - V^{n+1} e^{I(i-1)\phi})
\end{align}</script>

<p>Simplifying and rearranging, we find that the amplication factor $G$ is given by</p>

<script type="math/tex; mode=display">\begin{align}
G = \dfrac{V^{n+1}{V^n}} = 1 - \dfrac{\sigma}{2}(2I\sin\phi)
\end{align}</script>

<p>Requiring that $\lvert G \rvert &lt; 1$ means that $\sqrt{1+\sigma^2\sin^2\phi} &lt; 1$ which is never the case. Therefore, this numerical scheme that is forward differnece in time and central difference in space in <em>unconditionally unstable</em>. This means that there are no conditions under which the scheme exhibits stability. Of course one could imagine schemes that are unconditonally stable (forward difference in time and implicit central difference in space), conditionally stable (explicit first order in time and backward difference in space).</p>

<h2 id="computation-of-the-navier-stokes-equations">Computation of the Navier-Stokes Equations</h2>

<p>The Navier-Stokes equation is the statement of conservation of momentun in differential form, and this coupled with the continuity equation (statement of mass conservation in differential form) allows us to solve for flows of Newtonian fluids under various conditions of pressure. However there seems to be a problem: at first sight there seems to be no obvious way to couple the velocity with pressure as there isn’t a consitutive equation. We get around this fact by recognizing that we can write a Poisson equation for pressure that can be solved. Consider again the 2D Navier stokes equations:</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{align}
\frac{\partial u}{\partial t}+u\frac{\partial u}{\partial x}+v\frac{\partial u}{\partial y} & = -\frac{1}{\rho}\frac{\partial p}{\partial x}+\nu \left(\frac{\partial^2 u}{\partial x^2}+\frac{\partial^2 u}{\partial y^2} \right) \label{eqn:nsu}\\

\frac{\partial v}{\partial t}+u\frac{\partial v}{\partial x}+v\frac{\partial v}{\partial y} = -\frac{1}{\rho}\frac{\partial p}{\partial y}+\nu\left(\frac{\partial^2 v}{\partial x^2}+\frac{\partial^2 v}{\partial y^2}\right) \label{eqn:nsv}
\end{align} %]]></script>

<p>Partially differentiating Equations \ref{eqn:nsu} and \ref{eqn:nsv} by $x$ and $y$ respectively, and adding the resulting two equations (while setting all terms that involve the divergence of velocity to 0) we obtain a Poisson equation for pressure:</p>

<script type="math/tex; mode=display">\begin{align}
\frac{\partial^2 p}{\partial x^2}+\frac{\partial^2 p}{\partial y^2} = -\rho\left(\frac{\partial u}{\partial x}\frac{\partial u}{\partial x}+2\frac{\partial u}{\partial y}\frac{\partial v}{\partial x}+\frac{\partial v}{\partial y}\frac{\partial v}{\partial y} \right)
\end{align}</script>

<p>We can  discretize the equations (using a forward difference for time, a backward difference for space and a central difference for diffusive terms) as follows:</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{align}
& \frac{u_{i,j}^{n+1}-u_{i,j}^{n}}{\Delta t}+u_{i,j}^{n}\frac{u_{i,j}^{n}-u_{i-1,j}^{n}}{\Delta x}+v_{i,j}^{n}\frac{u_{i,j}^{n}-u_{i,j-1}^{n}}{\Delta y} = \\ 
& \qquad -\frac{1}{\rho}\frac{p_{i+1,j}^{n}-p_{i-1,j}^{n}}{2\Delta x}+\nu\left(\frac{u_{i+1,j}^{n}-2u_{i,j}^{n}+u_{i-1,j}^{n}}{\Delta x^2}+\frac{u_{i,j+1}^{n}-2u_{i,j}^{n}+u_{i,j-1}^{n}}{\Delta y^2}\right)
\end{align} %]]></script>

<script type="math/tex; mode=display">% <![CDATA[
\begin{align}
&\frac{v_{i,j}^{n+1}-v_{i,j}^{n}}{\Delta t}+u_{i,j}^{n}\frac{v_{i,j}^{n}-v_{i-1,j}^{n}}{\Delta x}+v_{i,j}^{n}\frac{v_{i,j}^{n}-v_{i,j-1}^{n}}{\Delta y} = \\
& \qquad -\frac{1}{\rho}\frac{p_{i,j+1}^{n}-p_{i,j-1}^{n}}{2\Delta y}
+\nu\left(\frac{v_{i+1,j}^{n}-2v_{i,j}^{n}+v_{i-1,j}^{n}}{\Delta x^2}+\frac{v_{i,j+1}^{n}-2v_{i,j}^{n}+v_{i,j-1}^{n}}{\Delta y^2}\right)
\end{align} %]]></script>

<script type="math/tex; mode=display">% <![CDATA[
\begin{align}
& \frac{p_{i+1,j}^{n}-2p_{i,j}^{n}+p_{i-1,j}^{n}}{\Delta x^2}+\frac{p_{i,j+1}^{n}-2p_{i,j}^{n}+p_{i,j-1}^{n}}{\Delta y^2} = \\
& \qquad \rho \left[ \frac{1}{\Delta t}\left(\frac{u_{i+1,j}-u_{i-1,j}}{2\Delta x}+\frac{v_{i,j+1}-v_{i,j-1}}{2\Delta y}\right) -\frac{u_{i+1,j}-u_{i-1,j}}{2\Delta x}\frac{u_{i+1,j}-u_{i-1,j}}{2\Delta x} - 2\frac{u_{i,j+1}-u_{i,j-1}}{2\Delta y}\frac{v_{i+1,j}-v_{i-1,j}}{2\Delta x} - \frac{v_{i,j+1}-v_{i,j-1}}{2\Delta y}\frac{v_{i,j+1}-v_{i,j-1}}{2\Delta y}\right]
\end{align} %]]></script>

<p>Note that in the numerical scheme, we ideally want a divergence free velocity in the next step, so we can impose $\vec{\nabla}\cdot \vec{u} ^{n+1} = 0$. However, because of numerical and other errors, we cannot guarantee that in the current timestep $\vec{\nabla}\cdot \vec{u} ^{n} = 0$. So we <em>cannot</em> impose $\vec{\nabla}\cdot \vec{u} ^{n} = 0$ and we retain this terms in the computations. The three equation above look rather formidable so we will solve it in steps.</p>

<h2 id="step-9-laplace-equation">Step 9: Laplace Equation</h2>

<p>Discretizing the Laplace equation for pressure,</p>

<script type="math/tex; mode=display">\begin{align}
\frac{p_{i+1, j}^n - 2p_{i,j}^n + p_{i-1,j}^n}{\Delta x^2} + \frac{p_{i,j+1}^n - 2p_{i,j}^n + p_{i, j-1}^n}{\Delta y^2} = 0
\end{align}</script>

<p>Note that there is no time derivative in this equation. Conceptually, we could think of this equation as the steady state (i.e.) long time solution of an equation containing a time derivative. We can therefore, introduce an artificial time derivative and then solve the system iteratively for a number of timesteps until convergence is obtained. We can test for convergence by assuming some critetion of the L2 norm of $p ^{n} - p ^{n-1}$, for example, that it is smaller than some crticial value.</p>

<p>We rearrange the above discretized equation to find $p_{i, j} ^n$ in terms of the other quantites:</p>

<script type="math/tex; mode=display">\begin{align}
p_{i,j}^n = \frac{\Delta y^2(p_{i+1,j}^n+p_{i-1,j}^n)+\Delta x^2(p_{i,j+1}^n + p_{i,j-1}^n)}{2(\Delta x^2 + \Delta y^2)}
\end{align}</script>

<p>Because there are four other quantities $p_{i-1,j}^n, p_{i,j-1}^n, p_{i+1,j}^n, p_{i,j+1}^n$ that feed into $p_{i,j}^n$, this is known as the five point difference operator and is one of the most widely used numerical schemes for the Laplacian operator.  Let us now implement the solution of the discretized equation in Python. We assume an initial state of $p=0$ everywhere, and use the following boundary conditions:</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{align}
 & p = 0 \textrm{ at } x = 0 \\
& p = y \textrm{ at } x = 2 \\
& \dfrac{\partial p}{\partial y}=0$ \textrm{ at } y=0, 1
\end{align} %]]></script>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="n">insert</span> <span class="n">the</span> <span class="n">code</span> <span class="n">here</span> <span class="ow">and</span> <span class="n">include</span> <span class="nb">any</span> <span class="n">plots</span>
<span class="n">use</span> <span class="n">my</span> <span class="n">solution</span>
</code></pre></div></div>

<h2 id="step-10-2d-poisson-equation">Step 10: 2D Poisson Equation</h2>

<p>In this next step we solve the Poisson equation, which adds a source term to the Laplace equation. As we discussed above, deriving the Poisson equation for pressure allows us to couple the velocity fields and the pressure fields while numerically solving the Navier-Stokes equations. Because we have seen so many examples of obtaining the discretized equations, we simply provide the result here:</p>

<script type="math/tex; mode=display">\begin{align}
p_{i,j}^{n}=\frac{(p_{i+1,j}^{n}+p_{i-1,j}^{n})\Delta y^2+(p_{i,j+1}^{n}+p_{i,j-1}^{n})\Delta x^2-b_{i,j}^{n}\Delta x^2\Delta y^2}{2(\Delta x^2+\Delta y^2)}
\end{align}</script>

<p>The intial and boundary conditions are the same as before, but we the intial conditon on the source term is as follows:</p>

<script type="math/tex; mode=display">\begin{align}
b_{i,j}=100 \textrm{ at } i=\frac{1}{4}nx, j=\frac{1}{4}ny \\
b_{i,j}=-100 \textrm{ at } i=\frac{3}{4}nx, j=\frac{3}{4}ny \\
b_{i,j}=0 \textrm{ otherwise}
\end{align}</script>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">insert</span> <span class="n">my</span> <span class="n">code</span> <span class="n">here</span><span class="o">.</span>
<span class="n">use</span> <span class="n">my</span> <span class="n">solution</span> <span class="ow">and</span> <span class="n">the</span> <span class="n">modified</span> <span class="n">density</span> <span class="n">plots</span>
</code></pre></div></div>

<h2 id="step-11-cavity-flow-with-navier-stokes">Step 11: Cavity flow with Navier Stokes</h2>

<p>We are finally ready to put everything together to solve a realistic Navier Stokes problem. Below, we solve the cavity flow problem, i.e., the flow of liquid inside a boxed container with a constant flow at the open surface. More formally, the initial and boundary conditions are:</p>

<script type="math/tex; mode=display">\begin{align}
u, v, p = 0 \textrm{ everywhere at } t = 0 \\
u=1 \textrm{ at } y=2 \textrm{ (the "lid") }\\
u, v=0 \textrm{ on the other boundaries}\\
\dfrac{\partial p}{\partial y}=0 \textrm{ at } y=0\\
p=0 \textrm{ at } y=2\\
\dfrac{\partial p}{\partial x}=0 \textrm{ at } x=0,2
\end{align}</script>

<p>We use these boundary conditions to solve the discretized NS momentum and presurre Poisson equations  \ref{eqn:momentumx} - \ref{eqn:pressurepoisson}.</p>

<h2 id="references">References</h2>

<div class="footnotes">
  <ol>
    <li id="fn:1">
      <p>Batchelor, G.K., 1967. An introduction to fluid dynamics. Cambridge university press. <a href="#fnref:1" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:2">
      <p>Courant, R., Friedrichs, K. and Lewy, H., 1967. On the partial difference equations of mathematical physics. IBM journal of Research and Development, 11(2), pp.215-234. <a href="#fnref:2" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>

        
      </section>

      <footer class="page__meta">
        
        


        
      </footer>

      

      
  <nav class="pagination">
    
      <a href="#" class="pagination--pager disabled">Previous</a>
    
    
      <a href="/coursenotes/googlemachinelearning/" class="pagination--pager" title="Google Machine Learning Crash Course
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><input type="text" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
    <div id="results" class="results"></div></div>

      </div>
    

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
      
    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2019 Aditya Jaishankar. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script defer src="https://use.fontawesome.com/releases/v5.6.0/js/all.js" integrity="sha384-z9ZOvGHHo21RqN5De4rfJMoAxYpaVoiYhuJXPyVmSs8yn20IE3PmBM534CffwSJI" crossorigin="anonymous"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>








<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_CHTML"></script>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
tex2jax: {
inlineMath: [['$','$'], ['\\(','\\)']],
processEscapes: true},
jax: ["input/TeX","input/MathML","input/AsciiMath","output/CommonHTML"],
extensions: ["tex2jax.js","mml2jax.js","asciimath2jax.js","MathMenu.js","MathZoom.js","AssistiveMML.js", "[Contrib]/a11y/accessibility-menu.js"],
TeX: {
extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"],
equationNumbers: {
autoNumber: "AMS"
}
}
});
</script>


  </body>
</html>
